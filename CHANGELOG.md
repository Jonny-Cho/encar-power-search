# Changelog

엔카 파워 서치 Chrome Extension의 모든 변경사항을 기록합니다.

## [1.0.9] - 2025-08-10
### 🆕 새로운 기능
- **이력 숨김 필터** 추가 (사고유무 패널 하단)
  - 사용이력 있으면 숨김 (토글)
  - 내차 보험사고 횟수/금액 임계값 기반 숨김 (항목별 토글 + 입력)
  - 소유자 변경 횟수 임계값 기반 숨김 (토글 + 입력)
  - 보험 미가입 기간 N개월 이상 숨김 (기본 12개월, 토글 + 입력)
- 금액 입력시 천단위 콤마 자동 포맷

### 🔧 개선
- 숨김 로직을 별도 모듈(`LabelFilter`)로 분리하여 성능/안정성 향상
- SPA 라우팅/DOM 변경에도 자동 재적용 (MutationObserver)
- 설정은 `chrome.storage.sync`로 영구 저장되고 자동 복원

### 🖌️ UI
- 사고유무 패널과 동일한 체크박스/정렬/톤으로 통일
- 항목별 체크 시에만 임계값 입력 필드 노출

## [1.0.8] - 2025-08-09
### 변경사항
- MV3 멀티 모듈 구조 반영 및 백그라운드 배지 오류 가드 추가
- 보험사고 라벨 계산: API 제공 `myAccidentCnt`/`myAccidentCost` 사용으로 교체
- 리스트 좋아요 클릭 시 라벨 사라짐 방지(캐시 + MutationObserver 재주입)
- 팝업: 리뷰 버튼 추가 및 컨텐츠 스크립트 미주입 시 메시지 오류 무시 처리
- 사진우대/우대등록 섹션 숨김: 전역 스타일 + body 클래스 토글로 SPA 전환 대응

## [1.0.7] - 2025-08-04
### 🆕 새로운 기능
- **보험 미가입기간 라벨 추가**: API의 `notJoinDate1~5` 데이터를 활용하여 총 미가입 개월수 계산 및 표시
  - "YYYYMM~YYYYMM" 형식의 날짜 범위를 정확히 파싱
  - 여러 미가입 기간의 총합을 계산하여 "보험 미가입 N개월" 형태로 표시
  - 팝업에서 표시/숨김 토글 제어 가능
- **분홍색 라벨 디자인**: 기존 라벨들과 시각적으로 구분되는 분홍색(`#e83e8c`) 스타일링 적용
  - 호버 효과 포함 (진한 분홍색 `#d91a72`)
- **사진우대영역 라벨 지원**: 일반 검색결과와 사진우대영역 모두에서 보험 미가입기간 라벨 표시
  - 사진우대영역에서 작은 크기 라벨 자동 적용 (10px 폰트, 1px 패딩)
  - 기존 차량 이력 라벨들과 동일한 방식으로 표시

### 🔧 기술적 개선
- `calculateNoInsuranceMonths()` 함수 추가로 날짜 범위 정확 계산
  - 시작월과 끝월을 포함한 개월수 계산 (inclusive counting)
  - 유효하지 않은 날짜 형식에 대한 안전한 에러 처리
- 기존 차량 이력 라벨 시스템과 완벽 통합
  - `fetchVehicleHistory()` 함수에 미가입기간 처리 로직 추가
  - `addVehicleLabelsToRow()` 함수에 새로운 라벨 타입 지원
  - 일반 검색결과(`tr[data-index]`)와 사진우대영역(`#sr_photo li[data-index]`) 모두 처리
- Chrome Storage API를 통한 사용자 설정 영구 저장

### 📱 사용자 경험 향상
- 차량 구매 시 보험 가입 이력을 한눈에 확인 가능
- 다른 차량 이력 정보와 함께 종합적인 판단 근거 제공
- 직관적인 분홍색 라벨로 빠른 인식 가능
- 사진우대영역에서도 동일한 차량 이력 정보 제공

### 추가
- 보험 미가입기간 표시 토글 스위치 (팝업 설정)
- CSS 클래스 기반 라벨 표시/숨김 제어 (`.hide-noinsurance-labels`)
- 사진우대영역 전용 라벨 크기 조정 CSS (`#sr_photo .noinsurance-label`)

## [1.0.6] - 2025-08-03
### 개선
- **사용이력 감지 로직 개선**
  - carInfoUse1s 코드에 '4' 추가하여 더 정확한 사용이력 감지
  - 코드 가독성 향상을 위한 리팩토링
  - `some()` 메서드와 배열을 활용한 더 명확한 조건 검사

## [1.0.5] - 2025-08-03
### 🚗 새로운 기능
- **보험사고 이력 표시**: 내차 보험사고 횟수와 총 수리비용을 빨간색 라벨로 표시
  - 타입 1, 2 사고를 내차사고로 분류 (타입 3 타인사고 제외)
  - 실제 사고 데이터 개수로 정확도 향상 (accidentCnt 대신 배열 길이 사용)
  - 팝업에서 표시/숨김 토글 제어 가능
- **소유자 변경이력 표시**: 소유자 변경 횟수를 보라색 라벨로 표시
  - ownerChanges 배열 데이터 활용
  - 팝업에서 표시/숨김 토글 제어 가능

### 개선
- 차량 이력 API 호출 통합으로 성능 최적화
  - 용도이력, 보험사고, 소유자 변경이력을 단일 API 호출로 처리
  - 불필요한 중복 API 호출 제거
- CSS 기반 라벨 표시/숨김 제어로 실시간 반응성 향상
  - 조건부 API 호출 대신 CSS 클래스로 토글 제어
  - 사용자 설정 변경 시 즉시 반영

### 추가
- 보험사고 이력 표시 토글 스위치 (팝업 설정)
- 소유자 변경이력 표시 토글 스위치 (팝업 설정)
- 새로운 라벨 스타일링
  - 보험사고 라벨: 빨간색 배경 (#dc3545)
  - 소유자 변경 라벨: 보라색 배경 (#6f42c1)
- CSS 클래스 기반 라벨 표시/숨김 제어 시스템

## [1.0.4] - 2025-08-03
### 🚗 핵심 기능 추가
- **사용이력 표시 기능**: 차량 목록에서 사용이력이 있는 차량을 "사용이력있음" 라벨로 표시
  - 엔카 API 연동을 통한 실시간 사용이력 정보 확인
  - 팝업에서 사용이력 표시 기능 ON/OFF 토글 가능
  - 배치 처리를 통한 효율적인 API 호출 (200개씩 병렬 처리)

### 추가
- 페이지당 최대 500개 보기 옵션 추가
  - 기존: 20, 30, 40, 50개
  - 확장: 100, 200, 300, 400, 500개까지 선택 가능
- 팝업에 "500개까지 보기 옵션 추가" 토글 기능

### 수정
- 사용이력 API 에러 핸들링 개선
  - 404 및 네트워크 오류 시 조용히 처리 (콘솔 로그 제거)
  - 에러 발생 시에도 확장 프로그램 정상 작동 보장
- Pagerow 토글 해제 시 원래 옵션(20-50)으로 정확히 복원
- knockout.js data-bind 속성 호환성 개선

### 성능 개선
- 사용이력 API 호출 배치 처리 (200개씩 병렬 처리)
- 사용이력 처리 안정성 향상

## [1.0.3] - 2025-08-02
### 추가
- 단순수리(Accident.F) 필터 옵션 추가
- 3단계 사고유무 필터링: 무사고 / 단순수리 / 사고있음
- 팝업에 단순수리 설명 추가 (외판부위만 수리)

### 수정
- 사고유무 필터 UI를 3개 옵션으로 확장
- URL 파라미터 처리 로직에 Accident.F 추가
- fallbackToggleAccidentFilter에서 모든 사고 타입 지원

## [1.0.2] - 2025-08-02
### 추가
- 우대등록 섹션 숨기기 토글 기능 추가
- 팝업 설정에서 우대등록 섹션 표시/숨김 제어 가능

### 수정
- 우대등록 섹션 선택자 정확도 개선
  - 기존: `.section.list:not(.special)` - 일반등록도 함께 숨겨지는 문제
  - 수정: `.section.list[data-bind*="specialSearchResults"]:not(.special)` - 우대등록만 정확히 타겟팅

## [1.0.1] - 2025-08-02
### 추가
- 사진우대 섹션 숨기기 토글 기능 추가
- Chrome Storage API를 통한 설정 영구 저장
- 팝업 UI에 토글 스위치 컴포넌트 추가

### 수정
- manifest.json에 storage 권한 추가
- HTTP 프로토콜 지원 추가 (http://www.encar.com)

## [1.0.0] - 2025-07-31
### 초기 릴리즈
- 엔카 검색 페이지에 "사고유무" 필터 추가
- 무사고 차량 필터링 기능
  - 무사고만 보기
  - 사고차량만 보기
  - 전체 보기
- 엔카 기존 UI와 자연스러운 통합
- URL 해시 파라미터를 통한 필터 적용
- 필터 상태 유지 (페이지 새로고침 시에도 유지)

---

형식: [Semantic Versioning](https://semver.org/lang/ko/)을 따릅니다.